/*! Packages 30-01-2015 */

!function(){"use strict";var a=angular.module("BlogApp",["ngRoute","angular-toArrayFilter"]);a.config(["$routeProvider",function(a){a.when("/",{redirectTo:"/posts"}).when("/posts/:param?",{templateUrl:"posts.html",controller:"PostsCtrl"}).when("/post/:param?",{templateUrl:"post.html",controller:"PostCtrl"}).when("/admin/:param?",{templateUrl:"admin.html",controller:"AdminCtrl"})}]),a.controller("NavCtrl",["$scope","navService","activeService",function(a,b,c){var d=b.navElms;d.then(function(b){a.data=b.data}),a.activate=function(a){return a===c.data?"active":""}}]),a.controller("PostsCtrl",["$scope","$filter","$location","$route","$routeParams","postsService","activeService","sanitizeService",function(a,b,c,d,e,f,g,h){var i=f.getPosts;a.pages=[],i.then(function(c){a.data=c.data;var d=a.data.posts.length;if(3>d&&console.log("do nothing"),d>3)for(var f=Math.ceil(d/3),g=1;f+1>g;g++){a.pages[g]=[];for(var h=3*g-3;3*g>h;h++)a.data.posts[h]&&a.pages[g].push(a.data.posts[h])}a.pages=b("filterPosts")(a.pages),e.param?a.currentPage=Number(e.param):(a.currentPage=1,d>3&&console.log("change route param")),a.pages[a.currentPage-1]||$(".next").css("display","none"),a.pages[a.currentPage+1]||$(".previous").css("display","none")}),a.sanitize=h.getUrl,g.data=0,a.currentFilter=c.search().filter?"?filter="+c.search().filter:"",a.$watch(function(){return c.search().filter},function(a,b){c.search().filter&&a!==b&&c.path("posts/1")},!0),a.$on("$destroy",function(){g.data=null})}]),a.controller("PostCtrl",["$scope","$routeParams","postsService","sanitizeService",function(a,b,c,d){var e=c.getPosts;a.url=b.param,a.sanitize=d.getUrl,e.then(function(b){a.data=b.data;for(var c=0;c<a.data.posts.length;c++)a.url===a.sanitize(a.data.posts[c].titles)&&(a.single=a.data.posts[c])})}]),a.controller("AdminCtrl",["$scope","activeService",function(a,b){b.data=1,a.$on("$destroy",function(){b.data=null})}]),a.factory("postsService",["$http",function(a){var b=a.get("data/posts.json");return{getPosts:b}}]),a.factory("navService",["$http",function(a){var b=a.get("data/nav.json");return{navElms:b}}]),a.factory("activeService",function(){return{data:null}}),a.factory("sanitizeService",function(){var a=function(a){return a=a.replace(/[$+,:;=@#|'"<>.^*()%!/\s]/g,"")};return{getUrl:a}}),a.controller("FiltersCtrl",["$scope","$filter","$route","postsService","sanitizeService",function(a,b,c,d,e){var f=d.getPosts;f.then(function(d){a.data=d.data,a.categories={},a.authors={},a.years={},a.numPosts=a.data.posts.length,a.keyUp=function(a){return Object.keys(a)},a.sanitize=e.getUrl,a.addFilter=function(a){return"?filter="+a},a.$on("$routeChangeSuccess",function(){var b=c.current.params.param,d=c.current.$$route.controller;a.param=b&&"PostsCtrl"===d?"/"+b:""});for(var f=0;f<a.data.posts.length;f++){for(var g=a.data.posts[f],h=g.author,i=g.date,j=b("date")(i,"yyyy"),k=b("date")(i,"MMMM"),l=0;l<g.tags.length;l++){var m=g.tags[l];a.categories[m]=a.categories[m]?a.categories[m]+1:1}a.authors[h]=a.authors[h]?a.authors[h]+1:1,a.years[j]?a.years[j][k]=a.years[j][k]?a.years[j][k]+1:1:(a.years[j]={},a.years[j][k]=1)}})}]),a.filter("filterPosts",["$location","$filter","sanitizeService",function(a,b,c){return function(d){var e,f,g,h,i=[],j=[],k=a.search().filter;if(k)for(var l=0;l<d.length;l++){h=d[l];for(var m in h)if(h.hasOwnProperty(m)){var n=h[m];e=n.tags,f=n.author,g=n.date;for(var o=0;o<e.length;o++)e[o]===k&&j.push(n);k===c.getUrl(f)&&j.push(n);var p=b("date")(g,"MMMM"),q=b("date")(g,"yyyy");k===p+q&&j.push(n)}}else for(var r=0;r<d.length;r++){var s=d[r];for(var t in s)if(s.hasOwnProperty(t)){var u=s[t];j.push(u)}}j.sort(function(a,b){return parseFloat(b.date)-parseFloat(a.date)}),console.log(j);for(var v=j.length,w=Math.ceil(v/3),x=1;w+1>x;x++){i[x]=[];for(var y=3*x-3;3*x>y;y++)j[y]&&i[x].push(j[y])}return i}}])}();
//# sourceMappingURL=main.min.js.map